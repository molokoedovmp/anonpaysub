services:
  web:
    build:
      context: ./apps/web
    env_file:
      - ./.env
    environment:
      # Prefer IPv4 DNS results to avoid IPv6-related timeouts in Node/undici
      - NODE_OPTIONS=--dns-result-order=ipv4first
      - NEXT_TELEMETRY_DISABLED=1
    ports:
      - "3000:3000"
    dns:
      - 8.8.8.8
      - 1.1.1.1
    volumes:
      - ./apps/web:/app
      - /app/node_modules
    command: sh -c "npm install && npm run dev"
    logging:
      driver: json-file
      options:
        max-size: "10m"
        max-file: "3"

  bot:
    build:
      context: ./apps/bot
    env_file:
      - ./.env
    volumes:
      - ./apps/bot:/app
    depends_on:
      - web
    logging:
      driver: json-file
      options:
        max-size: "10m"
        max-file: "3"
