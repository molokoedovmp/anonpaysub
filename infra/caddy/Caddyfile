{$DOMAIN}, www.{$DOMAIN} {
    encode gzip zstd

    # Проксирование до Next.js (web) с явными таймаутами —
    # помогает избежать обрывов и "Failed to fetch" при долгих ответах внешних API
    reverse_proxy web:3000 {
        transport http {
            dial_timeout              10s
            response_header_timeout   60s
            read_timeout              60s
        }
    }

    # Логи запросов (помогает понять, доходит ли запрос до web)
    log {
        output stdout
        format console
        level INFO
    }

    @health {
        path /healthz
    }
    respond @health 200
}
